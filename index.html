<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<link rel="icon" href="logo.png" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Enderman Cheers Wallet</title>

<style>
:root{
  --bg:#000;
  --container:#1c1c1c;
  --panel:#2a2a2a;
  --accent:#4CAF50;
  --pix:#1A73E8;
  --text:#e6eef3;
  --muted:#9aa4ad;
  --footer:#fff;
  font-family:Inter,sans-serif;
  --zoom:1.25;
}
body{
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:20px;
  transform:scale(var(--zoom));
  transform-origin:top center;
}
.container{
  max-width:400px;
  margin:0 auto;
  background:var(--container);
  padding:25px;
  border-radius:20px;
  box-shadow:0 5px 25px rgba(0,0,0,0.6);
}
h1{
  text-align:center;
  margin:0 0 25px 0;
  font-size:32px;
}
.card{
  background:var(--panel);
  border-radius:14px;
  padding:18px;
  margin-bottom:18px;
}
input{
  width:100%;
  padding:7px;
  margin:5px 0;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.15);
  background:rgba(255,255,255,0.05);
  color:var(--text);
  font-size:15px;
  text-align:center;
}
input:focus{
  border-color:var(--accent);
  background:rgba(255,255,255,0.08);
}
button{
  padding:12px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  width:100%;
  background:var(--accent);
  color:#000;
  font-size:15px;
}
button:hover{
  opacity:0.85;
  transform:scale(1.02);
}
.small{
  font-size:14px;
  color:var(--muted);
  text-align:center;
}
pre{
  background:var(--panel);
  padding:10px;
  border-radius:10px;
  font-size:14px;
  max-height:220px;
  overflow:auto;
}
footer{
  text-align:center;
  margin-top:25px;
  font-size:15px;
  color:var(--footer);
}
#pixQRContainer img{
  border-radius:14px;
  display:block;
  margin:15px auto;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.min.js"></script>
</head>

<body>
<div class="container">
<h1>ENDERMAN CHEERS WALLET</h1>

<!-- Conectar Carteira -->
<div class="card">
  <button id="connectBtn">Conectar Carteira</button>
  <div id="walletAddr" class="small">Status: desconectado</div>
</div>

<!-- PIX + Mint -->
<div class="card">
  <h2 style="text-align:center">JANUS26</h2>
  <input id="pixValue" placeholder="Valor (BRL)"/>
  <input id="pixUserKey" placeholder="Chave PIX"/>
  <input id="userNote" placeholder="Observação (opcional)"/>
  <button id="pixQRBtn">Gerar QR Code + Mint</button>
  <div id="pixQRContainer"></div>
</div>

<!-- Logs -->
<div class="card">
  <h2 style="text-align:center">Logs</h2>
  <pre id="log">RUNNING HORIGAMI SUIT 1.0 ...</pre>
</div>

<!-- Guardian GX -->
<div class="card">
  <h2 style="text-align:center; color:#1db954;">Guardian GX - Trade 2025</h2>

  <label for="gxParam1">Parâmetro 1 (Performance mínima %):</label>
  <input id="gxParam1" placeholder="Ex: 5"/>

  <label for="gxParam2">Parâmetro 2 (Risco/ajuste %):</label>
  <input id="gxParam2" placeholder="Ex: 2"/>

  <label for="gxNumResults">Número de Resultados:</label>
  <input type="number" id="gxNumResults" value="10" min="1" max="10"/>

  <button id="gxRunBtn">Rodar Guardian GX</button>

  <div class="results" id="gxResults"></div>
</div>

<footer>©CEO LUCAS JANUARIO BRNC INC ®</footer>

<script>
// LOG
function log(msg){
  const l=document.getElementById("log");
  l.textContent += "\n"+msg;
  l.scrollTop=l.scrollHeight;
  console.log(msg);
}

// ETHERS
let provider=null, signer=null, contract=null;
const ABI=["function mintWithPaymentHash(bytes32 h, bytes a, uint256 v) external returns(uint256)"];

// Auto-connect se MetaMask já estiver ativa
async function autoConnect(){
  if(window.ethereum){
    provider=new ethers.BrowserProvider(window.ethereum);
    const accounts=await provider.send("eth_accounts",[]);
    if(accounts.length>0){
      signer=await provider.getSigner();
      document.getElementById("walletAddr").textContent="Conectado: "+await signer.getAddress();
      log("Carteira conectada automaticamente.");
    }
  }
}
autoConnect();

// Conectar Carteira
document.getElementById("connectBtn").onclick=async()=>{
  if(!window.ethereum){alert("MetaMask necessária."); return;}
  await ethereum.request({method:"eth_requestAccounts"});
  provider=new ethers.BrowserProvider(window.ethereum);
  signer=await provider.getSigner();
  document.getElementById("walletAddr").textContent="Conectado: "+await signer.getAddress();
  log("Carteira conectada.");

  const addr=prompt("Endereço do contrato JANUS26:");
  if(!ethers.isAddress(addr)){log("Contrato inválido."); return;}
  contract=new ethers.Contract(addr,ABI,signer);
  log("Contrato carregado.");
};

// SHA256
async function sha256Hex(text){
  const enc=new TextEncoder().encode(text);
  const hash=await crypto.subtle.digest("SHA-256",enc);
  return "0x"+Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

// === DAQ MainB Net Engine ===
const DAQEngine = {
  active: false,
  walletAddress: null,
  contract: null,
  interval: null,

  init: async function(signerInstance, contractInstance) {
    if(this.active) return; // já iniciado
    if(!signerInstance || !contractInstance) return;
    this.walletAddress = await signerInstance.getAddress();
    this.contract = contractInstance;
    this.active = true;
    log("[DAQ Engine] Inicializada para: "+this.walletAddress);

    this.interval = setInterval(async ()=>{
      try {
        if(!this.active) return;
        // Simulação de saldo
        let balance = Math.floor(Math.random()*1000);
        log(`[DAQ Engine] Saldo JANUS26: ${balance}`);
      } catch(e) {
        log("[DAQ Engine] Erro ao atualizar saldo: "+e);
      }
    }, 10000);
  },

  stop: function() {
    this.active = false;
    if(this.interval) clearInterval(this.interval);
    log("[DAQ Engine] Desativada.");
  },

  mintMonitor: async function(amount, key, note){
    if(!this.active || !this.contract) {log("[DAQ Engine] Engine não ativa."); return;}
    try {
      const txData = amount+key+note;
      const hash = await sha256Hex(txData);
      const amountWei = BigInt(Math.floor(parseFloat(amount)*1e15));
      const tx = await this.contract.mintWithPaymentHash(hash,"0x",amountWei);
      log("[DAQ Engine] Mint enviado: "+tx.hash);
      await tx.wait();
      log("[DAQ Engine] Mint concluído via engine!");
    } catch(e){
      log("[DAQ Engine] Erro mint: "+e);
    }
  }
};

// Top 10 títulos trade 2025
const gxTopTrade2025 = [
  {ticker:'INOD', nome:'Innodata Inc.', performance:15},
  {ticker:'MIRM', nome:'Mirum Pharmaceuticals', performance:12},
  {ticker:'CEVA', nome:'CEVA Inc.', performance:10},
  {ticker:'OKLO', nome:'Oklo Inc.', performance:9},
  {ticker:'IKT', nome:'Inhibikase Therapeutics', performance:8},
  {ticker:'NVDA', nome:'NVIDIA', performance:18},
  {ticker:'MSFT', nome:'Microsoft', performance:12},
  {ticker:'AMZN', nome:'Amazon', performance:10},
  {ticker:'MU', nome:'Micron Technology', performance:9},
  {ticker:'PLTR', nome:'Palantir Technologies', performance:11}
];

// Função de score para o Guardian GX
function gxCalculateScore(item, param1, param2) {
  let p1 = parseFloat(param1) || 1;
  let p2 = parseFloat(param2) || 0;
  let score = item.performance * (p1/10) - p2;
  return score.toFixed(2);
}

// Função integrada à wallet
async function runGuardianGXWallet(param1, param2, numResults) {
  const resultsDiv = document.getElementById("gxResults");
  resultsDiv.innerHTML="";

  let selectedData = gxTopTrade2025.slice(0, numResults || 10);
  selectedData.forEach(item=>{
    const score = gxCalculateScore(item, param1, param2);
    const div = document.createElement("div");
    div.classList.add("result-item");
    div.innerHTML = `<strong>${item.ticker} - ${item.nome}</strong> | Performance: ${item.performance}% | Score: ${score}`;
    resultsDiv.appendChild(div);
  });

  log(`[Guardian GX] Scan executado: ${numResults || 10} resultados mostrados.`);
}

// Botão Guardian GX
document.getElementById("gxRunBtn").addEventListener("click", ()=>{
  const param1 = document.getElementById("gxParam1").value;
  const param2 = document.getElementById("gxParam2").value;
  const numResults = parseInt(document.getElementById("gxNumResults").value) || 10;

  runGuardianGXWallet(param1, param2, numResults);
});

// Botão PIX + Mint acionando engine
document.getElementById("pixQRBtn").addEventListener("click", async ()=>{
  if(!signer || !contract){log("Conecte carteira e contrato antes."); return;}
  await DAQEngine.init(signer, contract);

  const amount=document.getElementById("pixValue").value.trim();
  const key=document.getElementById("pixUserKey").value.trim();
  const note=document.getElementById("userNote").value.trim();

  if(!amount || !key){alert("Preencha valor e chave PIX."); return;}
  if(isNaN(amount)){alert("Valor inválido."); return;}

  const brcode=`000201...valor${amount}...chave${key}...note${note}`;
  const img=document.createElement("img");
  img.src="https://api.qrserver.com/v1/create-qr-code/?size=225x225&data="+encodeURIComponent(brcode);
  const container=document.getElementById("pixQRContainer");
  container.innerHTML=""; 
  container.appendChild(img);
  log("QRCode PIX gerado.");

  await DAQEngine.mintMonitor(amount,key,note);
});
</script>
</body>
</html>
